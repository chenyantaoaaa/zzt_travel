<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Guita</title>
	<!-- Custom Fonts -->
	<link href="../../font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

	<link href="../../css/landing-page.css" rel="stylesheet">
	<link href="../../css/bootstrap.min.css" rel="stylesheet">
	<script src="../../js/jquery-1.9.1.min.js"></script>

	<script src="../../js/bootstrap.min.js"></script>
	<script src="../../js/bootstrap-table.js"></script>
	<!-- file input -->
	<link href="../../css/fileinput.min.css" rel="stylesheet">
	<script src="../../js/fileinput.min.js"></script>
	<script src="../../js/locales/zh.js" type="text/javascript"></script>

	<link rel="icon" href="../../img/me.png">
	<link rel="shortcut icon" href="../../img/me.png">


	<script type="text/javascript" src="../../boot_plugins/Nivo-Slider-master/jquery.nivo.slider.js"></script>
	<link href="../../css/bootstrap-table.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="../../boot_plugins/Nivo-Slider-master/nivo-slider.css"  type="text/css" media="screen" />
	<link rel="stylesheet" href="../../boot_plugins/Nivo-Slider-master/demo/style.css" type="text/css" media="screen" />
	<style>
		.weather{ float: left; list-style: none; margin-left:8px;}
		.btn { font-family:"微软雅黑";}
		.section-heading { font-family:"微软雅黑"; font-style:italic;}
		.lead { font-family:"微软雅黑";}
		.table th, .table td {
			text-align: center;
			vertical-align: middle!important;
		}
		.btn-sm { border-radius:6px;}
		#actionG { top: 10px;}
		#bgMusic { display: none;float: left;}
		#musicBtn { display: none;float: left; height: 32px; width: 50px;font-family:"微软雅黑";}
		#audioPart{ padding-bottom: 35px;}
	</style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation">
	<div class="container topnav">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a class="navbar-brand topnav" href="#">TaoShao's Home</a>
		</div>
		<!-- Collect the nav links, forms, and other content for toggling -->
		<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href="#about">About</a>
				</li>
				<li>
					<a href="#services">Services</a>
				</li>
				<li>
					<a href="#contact">Contact</a>
				</li>
			</ul>
		</div>
		<!-- /.navbar-collapse -->
	</div>
	<!-- /.container -->
</nav>
<div id="wrapper">
	<a href="http://www.daweijita.com/" id="dev7link" title="Go to 大伟吉他教室">大伟吉他教室</a>

	<div class="slider-wrapper theme-default">
		<div id="slider" class="nivoSlider">
			<a href="http://www.daweijita.com/18414.html" target="_blank"><img src="../../img/guita/dawei2.png" data-thumb=="../../img/guita/dawei2.png" alt=""/></a>
			<a id="qfdeImg" onclick="audioFuc()"><img id="ddd" src="../../img/guita/qingfei.png" data-thumb="../../img/guita/qingfei.png" alt=""/></a>
			<a href=""><img src="images/up.jpg" data-thumb="images/up.jpg" alt="" /></a>
			<img src="images/walle.jpg" data-thumb="images/walle.jpg" alt="" data-transition="slideInLeft" />
		</div>
		<div id="htmlcaption" class="nivo-html-caption">
			<strong>This</strong> is an example of a <em>HTML</em> caption with <a href="#">a link</a>.
		</div>
	</div>
</div>
<div id="audioPart">
	<audio id="bgMusic" src="../../videos/qfdy.mp3" controls="controls"></audio>
	<button id="musicBtn" onclick="hideAudio()">关闭</button>
</div>
<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h3 class="modal-title" id="myModalLabel" align="center">
					<p style="color: black; font-family: 微软雅黑">新增曲谱信息</p>
				</h3>
			</div>
			<div class="modal-body">
				<form id="addForm" class="bs-example bs-example-form" role="form" enctype="multipart/form-data">
					<div class="input-group" style="width: 566px;">
						<span class="input-group-addon">曲谱名称</span>
						<input type="text" id="scoreName" name="scoreName" class="form-control" placeholder="">
					</div>
					<div class="input-group col-lg-5" style="display: inline-table; margin-top: 10px;">
						<span class="input-group-addon">曲谱类型</span>
						<input type="text" id="type" name="type" class="form-control">
					</div>
					<div class="input-group col-lg-5" style="display: inline-table; margin-top: 10px;margin-left: 90px;">
						<span class="input-group-addon">曲谱难度</span>
						<input type="text" id="difficulty"  name="difficulty" class="form-control">
					</div>
					<div class="input-group col-lg-5" style="margin-top: 10px;">
						<span class="input-group-addon">曲调</span>
						<input type="text" id="tune" name="tune" class="form-control">
					</div>
					<div class="input-group" style="width: 566px; margin-top: 10px;">
						<input id="fileup" name="fileup[]" type="file" class="file" multiple=true class="file-loading"/>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭
				</button>
				<button type="button" class="btn btn-primary" onclick="addScores()">
					提交
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>

<div class="btn-toolbar" role="toolbar">
	<div class="btn-toolbar" role="toolbar">
		<div class="btn-group" id="actionG">
			<button type="button" class="btn btn-default admin"  style="display: none" data-toggle="modal" data-target="#myModal"><i class="fa fa-plus-square fa-fw"></i>新增</button>
			<button type="button" class="btn btn-default admin"  style="display: none"><i class="fa fa-minus-square fa-fw"></i>删除</button>
		</div>
		<table class="table table-hover" id="cusTable"
			   data-pagination="true"
			   data-show-refresh="true"
			   data-show-toggle="true"
			   data-showColumns="true">
			<thead>
			<tr>
				<th  data-field="scoreName" data-sortable="true">
					吉他谱名
				</th>
				<th data-field="tune" >
					曲调
				</th>
				<th data-field="type">
					曲谱类型
				</th>
				<th data-field="difficulty">
					曲谱难度
				</th>
				<!-- 在此省略表格列的代码，代码和上面差不多 -->
				<th class="col-xs-2" data-field="action" data-formatter="operateFormatter" data-events="actionEvents">Action</th>
			</tr>
			</thead>
			<tbody>
			</tbody>
		</table>

		<!-- common -->
		<script src="../../js/common.js"></script>
		<!-- config -->
		<script src="../../js/config.js"></script>
		<script type="text/javascript">
			function initTable() {
				//先销毁表格
				$('#cusTable').bootstrapTable('destroy');
				//初始化表格,动态从服务器加载数据
				$("#cusTable").bootstrapTable({
					method: "get",  //使用get请求到服务器获取数据
					url: urlConfig+"guita/queryGuitaInfo.action",
					striped: true,  //表格显示条纹
					pagination: true, //启动分页
					pageList: [5, 10, 15, 20, 25],  //记录数可选列表
					search: false,  //是否启用查询
					showColumns: true,  //显示下拉框勾选要显示的列
					showRefresh: true,  //显示刷新按钮
					sidePagination: "server", //设置为服务器端分页
					//设置为undefined可以获取pageNumber，pageSize，searchText，sortName，sortOrder
					//设置为limit可以获取limit, offset, search, sort, order
					queryParamsType :'limit',
					queryParams: queryParams,
					onLoadSuccess: function(data){  //加载成功时执行

					},
					onLoadError: function(){  //加载失败时执行
						/* alert("加载数据失败", {time : 1500, icon : 2}); */
					}
				});
			}

			function queryParams(params) {  //配置参数
				var temp = {   //这里的键的名字和控制器的变量名必须一直，这边改动，控制器也需要改成一样的
					pageSize: params.limit,   //页面大小
					pageNumber: params.offset,  //页码
				};
				return temp;
			}

			$(document).ready(function () {
				//调用函数，初始化表格
				initTable();

				//当点击查询按钮的时候执行
				$("#search").bind("click", initTable);
				judgeAuthority();
			});

			$(window).load(function() {
				$('#slider').nivoSlider();
			});

			function operateFormatter(value, row, index) {
				return [
					'<button type="button" class="RoleOfA btn btn-default  btn-sm" style="margin-right:15px;">查看曲谱</button>',
//					'<button type="button" class="RoleOfB btn btn-default  btn-sm" style="margin-right:15px;">备注</button>',
				].join('');
			}

			window.actionEvents = {
				'click .RoleOfA': function (e, value, row, index) {
					var  getval =row.scoreImage;
					document.location="score.html?img="+getval;
				},
				'click .RoleOfB': function (e, value, row, index) {
					alert("B");
				}
			}

			function judgeAuthority(){
				$.ajax({
					type: "post",
					url: urlConfig+"user/session.action",
					contentType: 'application/json;charset=utf-8',
					success: function (data) {
						for(var i=0;i<data.roleList.length;i++){
							if(data.roleList[i]=="admin"){
								$(".admin").css("display","block");
							}
						}
					}
				})
			}
			/*   function addScores(){
			 var data=$('#addForm').serialize();//获取值
			 data= decodeURIComponent(data,true);//防止中文乱码
			 var json=DataDeal.formToJson(data);//转化为json
			 alert(json);
			 $.ajax({
			 type: "post",
			 url: "http://localhost:8080/web/guita/addGuitaInfo.action",
			 data:json,
			 contentType:'application/json;charset=utf-8',
			 success: function(data) {

			 }
			 });
			 }; */

			function addScores(){
				$("#fileup").fileinput("upload");
			}


			var DataDeal = {
				//将从form中通过$('#form').serialize()获取的值转成json
				formToJson: function (data) {
					data=data.replace(/&/g,"\",\"");
					data=data.replace(/=/g,"\":\"");
					data="{\""+data+"\"}";
					return data;
				},

			};

			//初始化fileinput控件（第一次初始化）
			function initFileInput(ctrlName, uploadUrl) {
				var control = $('#' + ctrlName);


				control.fileinput({
					language: 'zh', //设置语言
					uploadUrl: uploadUrl, //上传的地址
					uploadAsync:false,
					allowedFileExtensions : ['jpg', 'png','gif'],//接收的文件后缀
					showUpload: false,//是否显示上传按钮
					maxFileCount: 15,
					showPreview:true,
					enctype: 'multipart/form-data',
					showCaption: false,//是否显示标题
					browseClass: "btn btn-primary", //按钮样式
					previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
					uploadExtraData:function (previewId, index) {
						var obj = {};
						$('#addForm').find('input').each(function() {
							var id = $(this).attr('id'), val = $(this).val();
							obj[id] = val;
						});
						return obj;
					}
				});
			}

			//初始化fileinput
			initFileInput("fileup", urlConfig+"guita/addGuitaInfo.action");

			$("#fileup").on('filebatchuploadsuccess', function(event, data, previewId, index) {
				$('#addForm').find('input').each(function() {
					$(this).val("");
				});
				$('#fileup').fileinput('reset');
				$("#myModal").modal("hide");
			});


			audio = document.getElementById('bgMusic');
			function audioFuc() {
				if(audio.paused) {
					audio.style.display="block";
					audio.play();
					$("#musicBtn").show();
				} else {
					audio.style.display="none";
					audio.pause();
					$("#musicBtn").hide();
				}
			}
			function hideAudio() {
				$("#musicBtn").hide();
				audio.pause();
				audio.style.display="none";
			}
		</script>
</body>
<script>

</script>
</html>